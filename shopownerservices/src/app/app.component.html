<div class="container mt-5">
  <h1 class="mb-4">Shop Owner Management</h1>

  <form [formGroup]="ownerForm" (ngSubmit)="saveOwner()" class="card p-4 mb-5">
    <h3 class="mb-3">{{ isEditMode ? 'Edit Shop Owner' : 'Add New Shop Owner' }}</h3>
    
    <div class="mb-3">
    <label for="ownerName" class="form-label">Owner Name:</label>
    <input 
      id="ownerName"
      type="text"
      class="form-control" 
      formControlName="name"
      [class.is-invalid]="name?.invalid && name?.touched"
      placeholder="Enter owner name" />

    @if (name?.invalid && name?.touched) {
      <div class="invalid-feedback">
        @if (name?.errors?.['required']) {
          <span>Owner name is required</span>
        }
        @if (name?.errors?.['minlength']) {
          <span>Name must be at least 2 characters</span>
        }
        @if (name?.errors?.['maxlength']) {
          <span>Name cannot exceed 50 characters</span>
        }
      </div>
    }
  </div>

  <div class="mb-3">
    <label for="shopName" class="form-label">Shop Name:</label>
    <input 
      id="shopName"
      type="text"
      class="form-control" 
      formControlName="shopName"
      [class.is-invalid]="shopName?.invalid && shopName?.touched"
      placeholder="Enter shop name" />
      
    @if (shopName?.invalid && shopName?.touched) {
      <div class="invalid-feedback">
        @if (shopName?.errors?.['required']) {
          <span>Shop name is required</span>
        }
        @if (shopName?.errors?.['minlength']) {
          <span>Shop name must be at least 2 characters</span>
        }
        @if (shopName?.errors?.['maxlength']) {
          <span>Shop name cannot exceed 50 characters</span>
        }
      </div>
    }
  </div>

  <div class="mb-3">
    <label for="contactInfo" class="form-label">Contact Info (Phone or Email):</label>
    <input 
      id="contactInfo"
      type="text"
      class="form-control" 
      formControlName="contactInfo"
      [class.is-invalid]="contactInfo?.invalid && contactInfo?.touched"
      placeholder="Enter 10-digit phone or email" />
    
    <small class="text-muted">Enter a 10-digit phone number or valid email address</small>

    @if (contactInfo?.invalid && contactInfo?.touched) {
      <div class="invalid-feedback">
        @if (contactInfo?.errors?.['required']) {
          <span>Contact info is required</span>
        }
        @if (contactInfo?.errors?.['pattern']) {
          <span>Enter a valid 10-digit phone number or email</span>
        }
      </div>
    }
  </div>

    <div class="mb-3"> 
      <button 
        type="submit" 
        class="btn btn-primary me-2"
        [disabled]="ownerForm.invalid || loading">
    
      @if (!loading) {
      <span>{{ isEditMode ? 'Update' : 'Add' }}</span>
      }
    
      @if (loading) {
        <span>
          <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
          Loading...
        </span>
      }
    </button>

    <button 
      type="button" 
      class="btn btn-secondary" 
      (click)="resetForm()" 
      [disabled]="loading">
      Clear
    </button>
  </div>
  </form>

  <div class="card p-4">
    <h3 class="mb-3">Shop Owners List</h3>
    
    <div *ngIf="loading" class="alert alert-info">
      <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
      Loading data...
    </div>

    <div *ngIf="!loading && owners.length === 0" class="alert alert-info">
      No shop owners found. Add one to get started!
    </div>

    <table class="table table-striped table-hover" *ngIf="!loading && owners.length > 0">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Owner Name</th>
          <th>Shop Name</th>
          <th>Contact Info</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let owner of owners">
          <td>{{ owner.id }}</td>
          <td>{{ owner.name }}</td>
          <td>{{ owner.shopName }}</td>
          <td>{{ owner.contactInfo }}</td>
          <td>
            <button class="btn btn-sm btn-warning me-2" (click)="editOwner(owner)" [disabled]="loading">Edit</button>
            <button class="btn btn-sm btn-danger" (click)="deleteOwner(owner.id)" [disabled]="loading">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
